!function t(e,r,o){function a(s,i){if(!r[s]){if(!e[s]){var l="function"==typeof require&&require;if(!i&&l)return l(s,!0);if(n)return n(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var c=r[s]={exports:{}};e[s][0].call(c.exports,function(t){var r=e[s][1][t];return a(r?r:t)},c,c.exports,t,e,r,o)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<o.length;s++)a(o[s]);return a}({1:[function(t,e,r){var o=t("./range");e.exports.overflowX=function(t,e,r){var a=[];return a[0]=o.min(t,e.accessor),a[1]=o.max(t,e.accessor),a[1]=o.applyOverflow(a[0],a[1],r,e.data_type),a},e.exports.overflowY=function(t,e,r,a){var n=[];return n[0]=o.minMultipleSets(t,e,r),n[1]=o.maxMultipleSets(t,e,r),n[1]=o.applyOverflow(n[0],n[1],a,e[0].data_type),n}},{"./range":7}],2:[function(t,e,r){e.exports.row=function(t,e){for(var r=[],o=0;o<t.length;o++)"undefined"!=typeof t[o][e]&&r.push(t[o]);return r}},{}],3:[function(t,e,r){var o=(t("./sort"),t("./id"));e.exports.data_types=function(t,e){for(var r=0;r<t.length;r++)for(var o=0;o<e.length;o++)"Number"==e[o].data_type?t[r][e[o].row]=parseFloat(t[r][e[o].row]):"Date"==e[o].data_type&&(t[r][e[o].row]=d3.time.format(e[o].date_format).parse(t[r][e[o].row]));return t},e.exports.ids=function(t,e){console.log(t),console.log(e);for(var r=0;r<t.length;r++)for(var a=0;a<e.length;a++)"index"!=e[a].type&&(t[r][o.get(e[a])]=t[r][e[a].row],delete t[r][e[a].row]);return t}},{"./id":4,"./sort":8}],4:[function(t,e,r){e.exports.get=function(t){return t.row+"#"+t.url},e.exports.invert=function(t,e){for(var r=0;r<e.length;r++)if(t==e[r].rowId)return e[r]},e.exports.raw=function(t,e){return t+"#"+e}},{}],5:[function(t,e,r){var o=t("./points");e.exports.mode="undefined",e.exports.addLine=function(t,r,o,a){var n=d3.select("#graph").append("path").attr("class","line").attr("style","stroke:"+r.color).attr("data-row",r.rowId);if("linear"==e.exports.mode||"undefined"==e.exports.mode)n.attr("d",e.exports.linear(o,a));else{d3.svg.line().x(accessor_scaled_x).y(accessor_scaled_y).interpolate(e.exports.mode)}},e.exports.linear=function(t,e){for(var r="",o="Weighted Price",a=0;a<t.length;a++){var n=e(t[a],o);r+=0!==a?"L"+n[0]+","+n[1]:"M"+n[0]+","+n[1],a!==t.length-1&&(r+=" ")}return r},e.exports.update=function(t,r,o,a,n){if("linear"==e.exports.mode||"undefined"==e.exports.mode)d3.select(".line[data-row='"+o.rowId+"']").attr("d",e.exports.linear(t,n(r,o)));else{var s=d3.svg.line().x(r.accessor_scaled).y(a(o)).interpolate(e.exports.mode);d3.select(".line[data-row='"+o.rowId+"']").attr("d",s(t))}},e.exports.setActivated=function(t,e,r){var a=d3.selectAll(".data-point[data-row='"+e+"']"),n=d3.selectAll(".line[data-row='"+e+"']");n.classed("hidden",!t);for(var s=0;s<r.length;s++)r[s].rowId==e&&(r[s].activated=t);t?(a.classed("hidden",!t),o.updateVisibility(r)):a.classed("hidden",!t)}},{"./points":6}],6:[function(t,e,r){e.exports.visible=!1,e.exports.updateVisibility=function(t){for(var r=0;r<t.length;r++){var o=d3.selectAll(".data-point[data-row='"+t[r].rowId+"']");console.log(t[r].activated),e.exports.visible&&t[r].activated?o.classed("hidden",!1):o.classed("hidden",!0)}}},{}],7:[function(t,e,r){e.exports.min=function(t,e){return d3.min(t,e)},e.exports.max=function(t,e){return d3.max(t,e)},e.exports.minMultipleSets=function(t,e,r){for(var o,a=0;a<e.length;a++)if(e[a].activated){var n=d3.min(t,r(e[a]));"undefined"!=typeof n&&("undefined"==typeof o||o>n)&&(o=n)}return console.log("range min: "),console.log(o),o},e.exports.maxMultipleSets=function(t,e,r){for(var o,a=0;a<e.length;a++)if(e[a].activated){var n=d3.max(t,r(e[a]));("undefined"==typeof o||n>o)&&(o=n)}return console.log("range max:"),console.log(o),o},e.exports.applyOverflow=function(t,e,r,o){return"Date"==o?new Date(t.getTime()+(e.getTime()-t.getTime())*r):"Number"==o?t+(e-t)*r:void 0}},{}],8:[function(t,e,r){e.exports=function(t,e){return t.sort(function(t,r){return e.accessor(t)<e.accessor(r)?-1:e.accessor(t)>e.accessor(r)?1:0}),t}},{}],9:[function(t,e,r){console.log("Tooltip"),e.exports.opt={},e.exports.nextIndex=function(t,e,r){for(var o=-1,a=0;a<t.length-1;a++){var n=e(t[a]),s=e(t[a+1]),i=r>=n,l=s>=r;i&&l&&(Δ1=Math.abs(e(t[a])-r),Δ2=Math.abs(e(t[a+1])-r),o=Δ1<Δ2?a:a+1)}return o},e.exports.tooltip=function(t,e,r,o,a,n,s){var i=d3.select("#tooltip[data-row='"+e+"']");if(i.classed("hidden",!s),i.empty()){i=a.append("g").attr("id","tooltip").attr("class","tooltip").attr("data-row",e),i.append("circle").attr("id","tooltip-circle");var l=i.append("g").attr("id","label");l.append("text").attr("text-anchor","middle").attr("id","label-text")}if(-1==o)return void i.attr("visibility","hidden");i.attr("visibility","visible"),i.select("#label-text").text(n(t[o])).attr("x",0).attr("y",-10);var d=r(t[o]);i.attr("transform","translate("+d[0]+","+d[1]+")")},e.exports.updateTooltip=function(t,r,o,a,n,s,i,l){if(e.exports.mouse){var d=e.exports.mouse[0]-e.exports.opt.graphTransform.xstart,c=r.invert(d),u=e.exports.nextIndex(t,a.accessor,c);e.exports.tooltip(t,n.rowId,l(a,n),u,d3.select("#graph"),function(t){return Math.round(1e3*s(n)(t))/1e3},n.activated)}}},{}],10:[function(t,e,r){function o(){function t(t){return function(o,n){if(o)return alert(o),void console.log(o);n=M.data_types(n,s[t].config),n=M.ids(n,s[t].config);for(var l=0;l<n.length;l++)r.push(n[l]);++e==s.length&&(r=k(r,i),console.log("loaded"),a(r))}}for(var e=0,r=[],o=0;o<s.length;o++)d3.csv(s[o].url,t(o))}function a(t){function e(){k.call(g),M.call(h);for(var e=0;e<l.length;e++){n.selectAll("circle.data-point[data-row='"+l[e].rowId+"']").attr("cx",i.accessor_scaled).attr("cy",v_accessor_scaled(l[e]))}for(var e=0;e<l.length;e++)b.updateTooltip(D.row(t,l[e].rowId),u,p,i,l[e],d,v_accessor_scaled,c),I.update(D.row(t,l[e].rowId),i,l[e],v_accessor_scaled,c)}function r(){a.scale(1),a.translate([0,0]),_=N.overflowY(t,l,d,1.1),p.domain(_),a.y(p),h.scale(p),e()}y=N.overflowX(t,i,1.1),_=N.overflowY(t,l,d,1.1),u.domain(y),p.domain(_);var o,a=d3.behavior.zoom().x(u).y(p).scaleExtent([.9,50]).on("zoom",e),n=d3.select("#visualization").attr("width",f).attr("height",v).call(a);n.append("mask").attr("id","mask").append("rect").attr("x",0).attr("y",0).attr("width",f-x.xstart-x.xend).attr("height",v-x.ytop-x.ybottom).attr("fill","white"),o=n.append("g").attr("id","graph").attr("transform","translate("+x.xstart+","+x.ytop+")").attr("mask","url(#mask)");for(var s=0;s<l.length;s++){var m=o.selectAll("circle[data-row='"+l[s].rowId+"']").data(D.row(t,l[s].rowId)).enter();m.append("circle").attr("class","data-point").attr("data-row",l[s].rowId).attr("cx",i.accessor_scaled).attr("cy",v_accessor_scaled(l[s]))}T.updateVisibility(l);var k=n.append("g").attr("class","axis axis-x").attr("transform","translate("+x.xstart+","+(v-x.ybottom)+")").call(g),M=n.append("g").attr("class","axis axis-y").attr("transform","translate("+x.xstart+",0)").call(h);n.append("rect").attr("id","overlay").attr("x",x.xstart).attr("y",x.ytop).attr("width",f-x.xstart-x.xend).attr("height",v-x.ytop-x.ybottom).on("mousemove",function(){b.mouse=d3.mouse(this);for(var e=0;e<l.length;e++)b.updateTooltip(D.row(t,l[e].rowId),u,p,i,l[e],d,v_accessor_scaled,c)});for(var s=0;s<l.length;s++)I.addLine(i,l[s],D.row(t,l[s].rowId),c(i,l[s]));$("select").on("change",function(){I.mode=this.value;for(var e=0;e<l.length;e++)I.update(D.row(t,l[e].rowId),i,l[e],v_accessor_scaled,c)}),$("#checkbox").on("change",function(){w=$(this).is(":checked")?!0:!1,T.visible=w,T.updateVisibility(l)});for(var s=0;s<l.length;s++)d3.select("#select-row").append("p").attr("class","select-row-item").classed("inactive",!l[s].activated).attr("style","border-color:"+l[s].color).attr("data-row",l[s].rowId).text(l[s].name?l[s].name:l[s].row),I.setActivated(l[s].activated,l[s].rowId,l),$(".select-row-item[data-row='"+l[s].rowId+"']").on("click",function(){var t=$(this).attr("data-row"),e=A.invert(t,l);$(this).hasClass("inactive")?($(this).toggleClass("inactive",!1),I.setActivated(!0,t,l),e.activated=!0):($(this).toggleClass("inactive",!0),I.setActivated(!1,t,l),e.activated=!1),r()})}var n,s,i,l,d,c,u,p,f,v,x,m,g,h,w,y,_,b=t("./modules/tooltip"),I=t("./modules/line"),k=t("./modules/sort"),T=t("./modules/points"),A=t("./modules/id"),M=t("./modules/format"),D=t("./modules/filter"),N=t("./modules/domain");w=!1,d3.json("meta.json",function(t,e){if(t)return console.log(t),void alert(t);n=[],s=e.datasets,i={},l=[];for(var r=d3.scale.category20(),a=0;a<s.length;a++)for(var w=s[a],y=w.url,_=0;_<w.config.length;_++){var I=w.config[_];I.url=y,I.rowId=A.get(I),n.push(I),"index"==I.type?i=I:"value"==I.type&&(I.color=r(l.length+1),"undefined"==typeof I.activated&&(I.activated=!0),l.push(I))}"Number"==i.data_type?u=d3.scale.linear():"Date"==i.data_type&&(u=d3.time.scale()),"Number"==l[0].data_type?p=d3.scale.linear():"Date"==l[0].data_type&&(p=d3.time.scale()),f=950,v=400,x={xstart:70,ytop:0,xend:0,ybottom:50},b.opt.graphTransform=x,m=[],u.range([0,f-x.xstart-x.xend]),p.range([v-x.ytop-x.ybottom,0]),g=d3.svg.axis().scale(u).orient("bottom").ticks(5),h=d3.svg.axis().scale(p).orient("left").ticks(5),i.accessor=function(t){return t[i.row]},i.accessor_scaled=function(t){return u(t[i.row])},d=function(t){return function(e){return e[t.rowId]}},v_accessor_scaled=function(t){return function(e){return p(e[t.rowId])}},c=function(t,e){return function(r){return[t.accessor_scaled(r),v_accessor_scaled(e)(r)]}},o()})},{"./modules/domain":1,"./modules/filter":2,"./modules/format":3,"./modules/id":4,"./modules/line":5,"./modules/points":6,"./modules/sort":8,"./modules/tooltip":9}]},{},[10]);
//# sourceMappingURL=script.js.map
