!function t(e,r,a){function o(s,i){if(!r[s]){if(!e[s]){var l="function"==typeof require&&require;if(!i&&l)return l(s,!0);if(n)return n(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var c=r[s]={exports:{}};e[s][0].call(c.exports,function(t){var r=e[s][1][t];return o(r?r:t)},c,c.exports,t,e,r,a)}return r[s].exports}for(var n="function"==typeof require&&require,s=0;s<a.length;s++)o(a[s]);return o}({1:[function(t,e,r){e.exports.row=function(t,e){for(var r=[],a=0;a<t.length;a++)"undefined"!=typeof t[a][e]&&r.push(t[a]);return r}},{}],2:[function(t,e,r){var a=(t("./sort"),t("./id"));e.exports.data_types=function(t,e){for(var r=0;r<t.length;r++)for(var a=0;a<e.length;a++)"Number"==e[a].data_type?t[r][e[a].row]=parseFloat(t[r][e[a].row]):"Date"==e[a].data_type&&(t[r][e[a].row]=d3.time.format(e[a].date_format).parse(t[r][e[a].row]));return t},e.exports.ids=function(t,e){console.log(t),console.log(e);for(var r=0;r<t.length;r++)for(var o=0;o<e.length;o++)"index"!=e[o].type&&(t[r][a.get(e[o])]=t[r][e[o].row],delete t[r][e[o].row]);return t}},{"./id":3,"./sort":7}],3:[function(t,e,r){e.exports.get=function(t){return t.row+"#"+t.url},e.exports.invert=function(t){return t.split("#")[0]},e.exports.raw=function(t,e){return t+"#"+e}},{}],4:[function(t,e,r){var a=t("./points");e.exports.mode="undefined",e.exports.addLine=function(t,r,a,o){var n=d3.select("#graph").append("path").attr("class","line").attr("style","stroke:"+r.color).attr("data-row",r.rowId);if("linear"==e.exports.mode||"undefined"==e.exports.mode)n.attr("d",e.exports.linear(a,o));else{d3.svg.line().x(accessor_scaled_x).y(accessor_scaled_y).interpolate(e.exports.mode)}},e.exports.linear=function(t,e){for(var r="",a="Weighted Price",o=0;o<t.length;o++){var n=e(t[o],a);r+=0!==o?"L"+n[0]+","+n[1]:"M"+n[0]+","+n[1],o!==t.length-1&&(r+=" ")}return r},e.exports.update=function(t,r,a,o,n){if("linear"==e.exports.mode||"undefined"==e.exports.mode)d3.select(".line[data-row='"+a.rowId+"']").attr("d",e.exports.linear(t,n(r,a)));else{var s=d3.svg.line().x(r.accessor_scaled).y(o(a)).interpolate(e.exports.mode);d3.select(".line[data-row='"+a.rowId+"']").attr("d",s(t))}},e.exports.setActivated=function(t,e,r){var o=d3.selectAll(".data-point[data-row='"+e+"']"),n=d3.selectAll(".line[data-row='"+e+"']");n.classed("hidden",!t);for(var s=0;s<r.length;s++)r[s].rowId==e&&(r[s].activated=t);t?(o.classed("hidden",!t),a.updateVisibility(r)):o.classed("hidden",!t)}},{"./points":5}],5:[function(t,e,r){e.exports.visible=!1,e.exports.updateVisibility=function(t){for(var r=0;r<t.length;r++){var a=d3.selectAll(".data-point[data-row='"+t[r].rowId+"']");console.log(t[r].activated),e.exports.visible&&t[r].activated?a.classed("hidden",!1):a.classed("hidden",!0)}}},{}],6:[function(t,e,r){e.exports.min=function(t,e){return d3.min(t,e)},e.exports.max=function(t,e){return d3.max(t,e)},e.exports.minMultipleSets=function(t,e,r){for(var a,o=0;o<e.length;o++){var n=d3.min(t,r(e[o]));(0==o||a>n)&&(a=n)}return a},e.exports.maxMultipleSets=function(t,e,r){for(var a,o=0;o<e.length;o++){var n=d3.max(t,r(e[o]));(0==o||n>a)&&(a=n)}return a},e.exports.applyOverflow=function(t,e,r,a){return"Date"==a?new Date(t.getTime()+(e.getTime()-t.getTime())*r):"Number"==a?t+(e-t)*r:void 0}},{}],7:[function(t,e,r){e.exports=function(t,e){return t.sort(function(t,r){return e.accessor(t)<e.accessor(r)?-1:e.accessor(t)>e.accessor(r)?1:0}),t}},{}],8:[function(t,e,r){console.log("Tooltip"),e.exports.opt={},e.exports.nextIndex=function(t,e,r){for(var a=-1,o=0;o<t.length-1;o++){var n=e(t[o]),s=e(t[o+1]),i=r>=n,l=s>=r;i&&l&&(Δ1=Math.abs(e(t[o])-r),Δ2=Math.abs(e(t[o+1])-r),a=Δ1<Δ2?o:o+1)}return a},e.exports.tooltip=function(t,e,r,a,o,n,s){var i=d3.select("#tooltip[data-row='"+e+"']");if(i.classed("hidden",!s),i.empty()){i=o.append("g").attr("id","tooltip").attr("class","tooltip").attr("data-row",e),i.append("circle").attr("id","tooltip-circle");var l=i.append("g").attr("id","label");l.append("text").attr("text-anchor","middle").attr("id","label-text")}if(-1==a)return void i.attr("visibility","hidden");i.attr("visibility","visible"),i.select("#label-text").text(n(t[a])).attr("x",0).attr("y",-10);var d=r(t[a]);i.attr("transform","translate("+d[0]+","+d[1]+")")},e.exports.updateTooltip=function(t,r,a,o,n,s,i,l){if(e.exports.mouse){var d=e.exports.mouse[0]-e.exports.opt.graphTransform.xstart,c=r.invert(d),p=e.exports.nextIndex(t,o.accessor,c);e.exports.tooltip(t,n.rowId,l(o,n),p,d3.select("#graph"),function(t){return Math.round(1e3*s(n)(t))/1e3},n.activated)}}},{}],9:[function(t,e,r){function a(){function t(t){return function(a,n){if(a)return alert(a),void console.log(a);n=A.data_types(n,s[t].config),n=A.ids(n,s[t].config);for(var l=0;l<n.length;l++)r.push(n[l]);++e==s.length&&(r=b(r,i),console.log("loaded"),o(r))}}for(var e=0,r=[],a=0;a<s.length;a++)d3.csv(s[a].url,t(a))}function o(t){function e(){T.call(g),A.call(h);for(var e=0;e<l.length;e++){s.selectAll("circle.data-point[data-row='"+l[e].rowId+"']").attr("cx",i.accessor_scaled).attr("cy",v_accessor_scaled(l[e]))}for(var e=0;e<l.length;e++)y.updateTooltip(M.row(t,l[e].rowId),p,u,i,l[e],d,v_accessor_scaled,c),_.update(M.row(t,l[e].rowId),i,l[e],v_accessor_scaled,c)}var r=[],a=[];r[0]=I.min(t,i.accessor),r[1]=I.max(t,i.accessor),a[0]=I.minMultipleSets(t,l,d),a[1]=I.maxMultipleSets(t,l,d),r[1]=I.applyOverflow(r[0],r[1],1.1,i.data_type),a[1]=I.applyOverflow(a[0],a[1],1.1,l[0].data_type),p.domain(r),u.domain(a);var o,n=d3.behavior.zoom().x(p).y(u).scaleExtent([.9,50]).on("zoom",e),s=d3.select("#visualization").attr("width",f).attr("height",v).call(n);s.append("mask").attr("id","mask").append("rect").attr("x",0).attr("y",0).attr("width",f-x.xstart-x.xend).attr("height",v-x.ytop-x.ybottom).attr("fill","white"),o=s.append("g").attr("id","graph").attr("transform","translate("+x.xstart+","+x.ytop+")").attr("mask","url(#mask)");for(var m=0;m<l.length;m++){var b=o.selectAll("circle[data-row='"+l[m].rowId+"']").data(M.row(t,l[m].rowId)).enter();b.append("circle").attr("class","data-point").attr("data-row",l[m].rowId).attr("cx",i.accessor_scaled).attr("cy",v_accessor_scaled(l[m]))}k.updateVisibility(l);var T=s.append("g").attr("class","axis axis-x").attr("transform","translate("+x.xstart+","+(v-x.ybottom)+")").call(g),A=s.append("g").attr("class","axis axis-y").attr("transform","translate("+x.xstart+",0)").call(h);s.append("rect").attr("id","overlay").attr("x",x.xstart).attr("y",x.ytop).attr("width",f-x.xstart-x.xend).attr("height",v-x.ytop-x.ybottom).on("mousemove",function(){y.mouse=d3.mouse(this);for(var e=0;e<l.length;e++)y.updateTooltip(M.row(t,l[e].rowId),p,u,i,l[e],d,v_accessor_scaled,c)});for(var m=0;m<l.length;m++)_.addLine(i,l[m],M.row(t,l[m].rowId),c(i,l[m]));$("select").on("change",function(){_.mode=this.value;for(var e=0;e<l.length;e++)_.update(M.row(t,l[e].rowId),i,l[e],v_accessor_scaled,c)}),$("#checkbox").on("change",function(){w=$(this).is(":checked")?!0:!1,k.visible=w,k.updateVisibility(l)});for(var m=0;m<l.length;m++)d3.select("#select-row").append("p").attr("class","select-row-item").classed("inactive",!l[m].activated).attr("style","border-color:"+l[m].color).attr("data-row",l[m].rowId).text(l[m].name?l[m].name:l[m].row),_.setActivated(l[m].activated,l[m].rowId,l),$(".select-row-item[data-row='"+l[m].rowId+"']").on("click",function(){var t=$(this).attr("data-row");$(this).hasClass("inactive")?($(this).toggleClass("inactive",!1),_.setActivated(!0,t,l)):($(this).toggleClass("inactive",!0),_.setActivated(!1,t,l))})}var n,s,i,l,d,c,p,u,f,v,x,m,g,h,w,y=t("./modules/tooltip"),_=t("./modules/line"),b=t("./modules/sort"),I=t("./modules/range"),k=t("./modules/points"),T=t("./modules/id"),A=t("./modules/format"),M=t("./modules/filter");w=!1,d3.json("meta.json",function(t,e){if(t)return console.log(t),void alert(t);n=[],s=e.datasets,i={},l=[];for(var r=d3.scale.category10(),o=0;o<s.length;o++)for(var w=s[o],_=w.url,b=0;b<w.config.length;b++){var I=w.config[b];I.url=_,I.rowId=T.get(I),n.push(I),"index"==I.type?i=I:"value"==I.type&&(I.color=r(l.length+1),"undefined"==typeof I.activated&&(I.activated=!0),l.push(I))}"Number"==i.data_type?p=d3.scale.linear():"Date"==i.data_type&&(p=d3.time.scale()),"Number"==l[0].data_type?u=d3.scale.linear():"Date"==l[0].data_type&&(u=d3.time.scale()),f=950,v=400,x={xstart:70,ytop:0,xend:0,ybottom:50},y.opt.graphTransform=x,m=[],p.range([0,f-x.xstart-x.xend]),u.range([v-x.ytop-x.ybottom,0]),g=d3.svg.axis().scale(p).orient("bottom").ticks(5),h=d3.svg.axis().scale(u).orient("left").ticks(5),i.accessor=function(t){return t[i.row]},i.accessor_scaled=function(t){return p(t[i.row])},d=function(t){return function(e){return e[t.rowId]}},v_accessor_scaled=function(t){return function(e){return u(e[t.rowId])}},c=function(t,e){return function(r){return[t.accessor_scaled(r),v_accessor_scaled(e)(r)]}},a()})},{"./modules/filter":1,"./modules/format":2,"./modules/id":3,"./modules/line":4,"./modules/points":5,"./modules/range":6,"./modules/sort":7,"./modules/tooltip":8}]},{},[9]);
//# sourceMappingURL=script.js.map
